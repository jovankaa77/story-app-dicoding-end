const CACHE_NAME="story-app-cache-v1",STATIC_CACHE="story-app-static-v1",DYNAMIC_CACHE="story-app-dynamic-v1",API_CACHE="story-app-api-v1",assetsToCache=["/","/index.html","/app.bundle.js","/app.webmanifest","/favicon.ico","/images/icon-192x192.png","/images/icon-512x512.png","/offline.html"];async function networkFirstStrategy(e){try{const t=await fetch(e),n=t.clone();return caches.open(API_CACHE).then((t=>{"GET"===e.method&&t.put(e,n)})),t}catch(t){return console.log("Fetch failed, serving from cache",t),await caches.match(e)||caches.match("/offline.html")}}async function cacheFirstStrategy(e){const t=await caches.match(e);if(t)return t;try{const t=await fetch(e);return caches.open(DYNAMIC_CACHE).then((n=>{"GET"===e.method&&n.put(e,t.clone())})),t}catch(t){return console.log("Fetch failed, serving fallback",t),"document"===e.destination?caches.match("/offline.html"):new Response("Network error happened",{status:408,headers:{"Content-Type":"text/plain"}})}}self.addEventListener("install",(e=>{console.log("[Service Worker] Installing..."),self.skipWaiting(),e.waitUntil(caches.open(STATIC_CACHE).then((e=>(console.log("[Service Worker] Caching assets..."),e.addAll(assetsToCache).then((()=>{console.log("[Service Worker] Assets cached successfully")})).catch((e=>{console.error("[Service Worker] Caching error:",e)}))))))})),self.addEventListener("activate",(e=>{console.log("[Service Worker] Activating..."),e.waitUntil(clients.claim()),e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>e.startsWith("story-app-")&&e!==STATIC_CACHE&&e!==DYNAMIC_CACHE&&e!==API_CACHE)).map((e=>(console.log(`Service Worker: Deleting old cache ${e}`),caches.delete(e))))))))})),self.addEventListener("fetch",(e=>{const{request:t}=e,n=new URL(t.url);n.origin===self.location.origin&&(n.pathname.startsWith("/api")||n.hostname.includes("dicoding.dev")?e.respondWith(networkFirstStrategy(t)):e.respondWith(cacheFirstStrategy(t)))})),self.addEventListener("push",(e=>{let t={title:"Notifikasi",body:"Ada pesan masuk!",url:"/"};if(e.data)try{t=e.data.json()}catch(n){t.body=e.data.text()}const n={body:t.body||"Pesan baru diterima.",icon:"/images/icon-192x192.png",badge:"/images/icon-512x512.png",data:{url:t.url||"/"},vibrate:[100,50,100]};e.waitUntil(self.registration.showNotification(t.title||"Notifikasi",n))})),self.addEventListener("notificationclick",(e=>{e.notification.close();const t=e.notification.data?.url||"/";e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(const n of e)if(n.url===t&&"focus"in n)return n.focus();if(clients.openWindow)return clients.openWindow(t)})))}));